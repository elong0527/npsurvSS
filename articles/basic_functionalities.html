<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic functionalities • npsurvSS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic functionalities">
<meta property="og:description" content="npsurvSS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">npsurvSS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/npsurvSS.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic_functionalities.html">Basic functionalities</a>
    </li>
    <li>
      <a href="../articles/example1.html">Example 1: Optimal randomization ratio</a>
    </li>
    <li>
      <a href="../articles/example2.html">Example 2: Delayed treatment effect</a>
    </li>
    <li>
      <a href="../articles/project-plan.html">Grammer of Study Design Planning</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/godwinyung/npsurvSS/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic functionalities</h1>
                        <h4 data-toc-skip class="author">Godwin Yung</h4>
            
            <h4 data-toc-skip class="date">2022-08-21</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/godwinyung/npsurvSS/blob/HEAD/vignettes/basic_functionalities.Rmd" class="external-link"><code>vignettes/basic_functionalities.Rmd</code></a></small>
      <div class="hidden name"><code>basic_functionalities.Rmd</code></div>

    </div>

    
    
<p>This vignette walks through the basic functions in npsurvSS. By the end, users should be able to:</p>
<ul>
<li>create an object that captures the distributional assumptions for a treatment arm</li>
<li>visualize the distributional assumptions</li>
<li>calculate power and sample size for a two-arm study</li>
<li>approximate an event-driven study by a time-driven study</li>
<li>simulate a two-arm study</li>
</ul>
<div class="section level2">
<h2 id="creating-objects-of-class-arm">Creating objects of class “arm”<a class="anchor" aria-label="anchor" href="#creating-objects-of-class-arm"></a>
</h2>
<p>The cornerstone of npsurvSS lies in objects of class “arm”. These objects are lists that capture for a treatment arm assumptions regarding its sample size, accrual, survival, censoring, and duration of follow-up. Once created, they serve as inputs for other functions, including functions for power/sample size calculation and trial simulation.</p>
<p>The following code creates two arms, an <code>active</code> arm and a <code>control</code> arm. Both arms will accrue 120 patients uniformly over 6 months and follow them for an additional 12 months. Patients will be subjected to loss of follow-up at an exponential rate of 0.00578. <code>active</code> and <code>control</code> patients will experience event at exponential rates of 0.0462 and 0.0578, respectively. The hazard ratio between the two arms is therefore approximately 0.8.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/godwinyung/npsurvSS" class="external-link">npsurvSS</a></span><span class="op">)</span></span>
<span><span class="va">active</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm.html">create_arm</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                     accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                     surv_scale<span class="op">=</span><span class="fl">0.0462</span>, </span>
<span>                     loss_scale<span class="op">=</span><span class="fl">0.00578</span>, </span>
<span>                     follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm.html">create_arm</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                     accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                     surv_scale<span class="op">=</span><span class="fl">0.0578</span>, </span>
<span>                     loss_scale<span class="op">=</span><span class="fl">0.00578</span>, </span>
<span>                     follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>In practice, investigators seldom consider exponential distributions on the hazard rate scale. Instead, they consider the median survival or survival probability at some milestone <em>t</em>. We have defined additional functions to facilitate this practice. <code>per2haz</code> is a simple code that can convert an exponential survival percentile to the hazard rate and vice versa.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">active</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm.html">create_arm</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                     accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                     surv_scale<span class="op">=</span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="co"># corresponds to 15 month median</span></span>
<span>                     loss_scale<span class="op">=</span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span>, <span class="co"># corresponds to 120 month median</span></span>
<span>                     follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm.html">create_arm</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                     accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                     surv_scale<span class="op">=</span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>, <span class="co"># corresponds to 12 month median</span></span>
<span>                     loss_scale<span class="op">=</span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span>, </span>
<span>                     follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="co"># convert median survival to hazard rate</span></span>
<span><span class="co">#&gt; [1] 0.04620981</span></span>
<span><span class="fu"><a href="../reference/per2haz.html">per2haz</a></span><span class="op">(</span><span class="fl">0.0462</span><span class="op">)</span> <span class="co"># convert hazard rate to median survival</span></span>
<span><span class="co">#&gt; [1] 15.00319</span></span></code></pre></div>
<p>Alternatively, <code>create_arm_lachin</code> allows investigators to specify exponential survival and censoring distributions by providing median survivals or milestone survivals.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">active</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm_lachin.html">create_arm_lachin</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                            accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                            surv_median<span class="op">=</span><span class="fl">15</span>,</span>
<span>                            loss_milestone<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="co"># corresponds to 120 month median</span></span>
<span>                            follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_arm_lachin.html">create_arm_lachin</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">120</span>, </span>
<span>                             accr_time<span class="op">=</span><span class="fl">6</span>, </span>
<span>                             surv_milestone<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="co"># corresponds to 12 month median</span></span>
<span>                             loss_median<span class="op">=</span><span class="fl">120</span>, </span>
<span>                             follow_time<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"   "lachin" "arm"</span></span></code></pre></div>
<p>Note that objects created by <code>create_arm_lachin</code> belong to class “lachin” and “arm”. “lachin” is a subclass of “arm”. It is named after the class of distributions considered by Lachin (1986), which covers uniform/truncated-exponential accrual, exponential survival, and exponential censoring. Check out the R Documentation <code><a href="../reference/create_arm.html">?create_arm</a></code> for examples of “arm” objects with more sophisticated assumptions, such as piecewise-uniform accrual, piecewise-exponential/Weibull survival, and Weibull censoring. While objects created by <code>create_arm_lachin</code> are always of class “lachin” and “arm”, objects created by <code>create_arm</code> are always of class “arm”, but not necessarily of class “lachin”.</p>
</div>
<div class="section level2">
<h2 id="visualizing-distributional-assumptions">Visualizing distributional assumptions<a class="anchor" aria-label="anchor" href="#visualizing-distributional-assumptions"></a>
</h2>
<p>Having created an “arm” object, visualizing its assumptions is easy. For example, the following code plots the accrual cumulative distribution function (CDF):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/daccr.html">paccr</a></span><span class="op">(</span>q<span class="op">=</span><span class="va">x</span>, arm<span class="op">=</span><span class="va">control</span><span class="op">)</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"Time from first patient in (month)"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Accrual CDF"</span>,</span>
<span>     type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_functionalities_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Likewise, the survival function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/dsurv.html">psurv</a></span><span class="op">(</span>q<span class="op">=</span><span class="va">x</span>, arm<span class="op">=</span><span class="va">control</span>, lower.tail<span class="op">=</span><span class="cn">F</span><span class="op">)</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"Time from study entry (month)"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Survival function"</span>,</span>
<span>     type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_functionalities_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Just as <code>pbinom</code> in the R package stats is accompanied by functions for the density, quantile, and random generation, <code>paccr</code> is similarly accompanied by <code>daccr</code>, <code>qaccr</code>, and <code>raccr</code>. Distribution functions <code>psurv</code> and <code>ploss</code> are further accompanied by <code>hsurv</code> and <code>hloss</code> for the hazard.</p>
</div>
<div class="section level2">
<h2 id="calculating-power-and-sample-size">Calculating power and sample size<a class="anchor" aria-label="anchor" href="#calculating-power-and-sample-size"></a>
</h2>
<p>Given an <code>active</code> arm and a <code>control</code> arm, calculating power and sample size is also easy. The following code calculates power under the default setting of an unweighted log-rank test with one-sided alpha 0.025:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2366524</span></span></code></pre></div>
<p>To calculate power for other tests:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># unweighted log-rank</span></span>
<span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2366524</span></span>
<span><span class="co"># Gehan-Breslow weighted log-rank</span></span>
<span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span>, weight<span class="op">=</span><span class="st">"n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2210357</span></span>
<span><span class="co"># difference in 12 month survival</span></span>
<span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"survival difference"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2050328</span></span>
<span><span class="co"># ratio of 12 month RMST</span></span>
<span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"rmst ratio"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1823979</span></span></code></pre></div>
<p>Power for multiple tests can be calculated simulateously:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/power_two_arm.html">power_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span><span class="op">)</span>,</span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span>, weight<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>,</span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"survival difference"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"rmst ratio"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   test     power</span></span>
<span><span class="co">#&gt; 1    1 0.2366524</span></span>
<span><span class="co">#&gt; 2    2 0.2210357</span></span>
<span><span class="co">#&gt; 3    3 0.2050328</span></span>
<span><span class="co">#&gt; 4    4 0.1823979</span></span></code></pre></div>
<p>To calculate sample size required to achieve 80% power:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/size_two_arm.html">size_two_arm</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, </span>
<span>             test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"weighted logrank"</span>, weight<span class="op">=</span><span class="st">"n"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"survival difference"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>test<span class="op">=</span><span class="st">"rmst ratio"</span>, milestone<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span>             <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   test       n0       n1        n       d0       d1        d</span></span>
<span><span class="co">#&gt; 1    1 609.7478 609.7478 1219.496 339.3015 292.4822 631.7837</span></span>
<span><span class="co">#&gt; 2    2 663.7018 663.7018 1327.404 369.3249 318.3627 687.6876</span></span>
<span><span class="co">#&gt; 3    3 729.6092 729.6092 1459.218 405.9998 349.9770 755.9768</span></span>
<span><span class="co">#&gt; 4    4 848.3117 848.3117 1696.623 472.0532 406.9159 878.9692</span></span></code></pre></div>
<p>Note that <code>size_two_arm</code> returns the required sample size <em>n</em> and expected number of events <em>d</em> (per arm and total). When calculating the required sample size per arm, it considers as input the specified ratio between the two arms (e.g. 120:120) while ignoring their individual values (e.g. 120 and 120). Thus, the following two “arm” objects result in the same sample size calculation for the unweighted log-rank test:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control_new</span> <span class="op">&lt;-</span> <span class="va">control</span></span>
<span><span class="va">active_new</span>  <span class="op">&lt;-</span> <span class="va">active</span></span>
<span><span class="va">control_new</span><span class="op">$</span><span class="va">size</span>  <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">active_new</span><span class="op">$</span><span class="va">size</span>   <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/size_two_arm.html">size_two_arm</a></span><span class="op">(</span><span class="va">control_new</span>, <span class="va">active_new</span><span class="op">)</span></span>
<span><span class="co">#&gt;        n0        n1         n        d0        d1         d </span></span>
<span><span class="co">#&gt;  609.7478  609.7478 1219.4956  339.3015  292.4822  631.7837</span></span></code></pre></div>
<p>Sample size for a trial with 2:1 randomization in favor of the active arm can be calculated like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">active_new</span><span class="op">$</span><span class="va">size</span>   <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/size_two_arm.html">size_two_arm</a></span><span class="op">(</span><span class="va">control_new</span>, <span class="va">active_new</span><span class="op">)</span></span>
<span><span class="co">#&gt;        n0        n1         n        d0        d1         d </span></span>
<span><span class="co">#&gt;  445.9943  891.9886 1337.9830  248.1789  427.8668  676.0457</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="event-driven-trials">Event-driven trials<a class="anchor" aria-label="anchor" href="#event-driven-trials"></a>
</h2>
<p>By containing the keys <code>follow_time</code> and <code>total_time</code>, “arm” objects intrinsically apply to time-driven trials that end when a fixed period of time has elapsed after the last patient in. However, they can also be used to approximate event-driven trials, trials in which the study ends when a desired number of events has been observed. Specifically, a trial requiring <em>d</em> events can be approximated by a trial of length <em>t</em>, where the expected number of events at <em>t</em> is equal to <em>d</em>. The functions <code>exp_events</code> and <code>exp_duration</code> can be useful for this purpose:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/exp_events.html">exp_events</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span><span class="op">)</span> <span class="co"># expected number of events</span></span>
<span><span class="co">#&gt; [1] 124.3367</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exp_duration.html">exp_duration</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, d<span class="op">=</span><span class="fl">150</span><span class="op">)</span> <span class="co"># study duration for expected number of events to equal d</span></span>
<span></span>
<span><span class="va">tau</span></span>
<span><span class="co">#&gt; [1] 23.75</span></span></code></pre></div>
<p>Therefore, under the given assumptions, a trial requiring 150 events can be approximated by a 23.75-month long trial. When updating the trial duration in an “arm” object, it is important to update both the <code>follow_time</code> and <code>total_time</code> to ensure their consistency:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control_new</span> <span class="op">&lt;-</span> <span class="va">control</span></span>
<span><span class="va">control_new</span><span class="op">$</span><span class="va">total_time</span>  <span class="op">&lt;-</span> <span class="va">tau</span></span>
<span><span class="va">control_new</span><span class="op">$</span><span class="va">follow_time</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">-</span> <span class="va">control_new</span><span class="op">$</span><span class="va">accr_time</span></span>
<span><span class="va">active_new</span>  <span class="op">&lt;-</span> <span class="va">active</span></span>
<span><span class="va">active_new</span><span class="op">$</span><span class="va">total_time</span>   <span class="op">&lt;-</span> <span class="va">tau</span></span>
<span><span class="va">active_new</span><span class="op">$</span><span class="va">follow_time</span>  <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">-</span> <span class="va">active_new</span><span class="op">$</span><span class="va">accr_time</span></span>
<span></span>
<span><span class="fu"><a href="../reference/exp_events.html">exp_events</a></span><span class="op">(</span><span class="va">control_new</span>, <span class="va">active_new</span><span class="op">)</span> <span class="co"># check expected number of events</span></span>
<span><span class="co">#&gt; [1] 149.975</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-a-trial">Simulating a trial<a class="anchor" aria-label="anchor" href="#simulating-a-trial"></a>
</h2>
<p>Finally, time-driven and event-driven trials can be simulated using the following code:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_trial.html">simulate_trial</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, duration<span class="op">=</span><span class="fl">18</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trial1</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;     arm time.accr   time.obs time.total censor   reason</span></span>
<span><span class="co">#&gt; 188   1 1.2837209 0.11390883   1.397630      1    event</span></span>
<span><span class="co">#&gt; 215   1 1.5677291 0.03339883   1.601128      1    event</span></span>
<span><span class="co">#&gt; 11    0 0.3604919 1.51201002   1.872502      1    event</span></span>
<span><span class="co">#&gt; 73    0 1.6944760 0.30501794   1.999494      1    event</span></span>
<span><span class="co">#&gt; 148   1 1.1125846 1.39149176   2.504076      0 followup</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">trial1</span><span class="op">$</span><span class="va">arm</span>, <span class="va">trial1</span><span class="op">$</span><span class="va">reason</span><span class="op">)</span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;     administration event followup</span></span>
<span><span class="co">#&gt;   0             47    69        4</span></span>
<span><span class="co">#&gt;   1             56    58        6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trial1</span><span class="op">$</span><span class="va">time.total</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span></span>
<span><span class="va">trial2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_trial.html">simulate_trial</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, events<span class="op">=</span><span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trial2</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;     arm  time.accr  time.obs time.total censor reason</span></span>
<span><span class="co">#&gt; 125   1 0.43123563 0.3843567  0.8155923      1  event</span></span>
<span><span class="co">#&gt; 67    0 0.47062424 0.6398377  1.1104620      1  event</span></span>
<span><span class="co">#&gt; 192   1 0.03715467 1.7265056  1.7636603      1  event</span></span>
<span><span class="co">#&gt; 219   1 1.28513886 0.9106190  2.1957578      1  event</span></span>
<span><span class="co">#&gt; 227   1 1.47340656 0.7423402  2.2157468      1  event</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">trial2</span><span class="op">$</span><span class="va">censor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 150</span></span></code></pre></div>
<p>If both <code>duration</code> and <code>events</code> are provided, the study will end whenever one of the criteria is met:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_trial.html">simulate_trial</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">active</span>, duration<span class="op">=</span><span class="fl">18</span>, events<span class="op">=</span><span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trial3</span><span class="op">$</span><span class="va">time.total</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">trial3</span><span class="op">$</span><span class="va">censor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 127</span></span></code></pre></div>
<p>Should it be desired, investigators may also simulate complete data (accrual, survival, censoring) for each individual treatment arm. Note that no cutoff (by number of events or time) is applied. Hence, no patients are administratively censored:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_arm.html">simulate_arm</a></span><span class="op">(</span><span class="va">control</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">control_sim</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   arm time.accr  time.obs time.total censor   reason time.surv time.loss</span></span>
<span><span class="co">#&gt; 1   1 0.8154663 27.188056  28.003522      1    event 27.188056  73.35650</span></span>
<span><span class="co">#&gt; 2   1 4.3949716 52.017778  56.412749      0 followup 92.902896  52.01778</span></span>
<span><span class="co">#&gt; 3   1 1.7184019  5.870242   7.588644      1    event  5.870242   6.36021</span></span>
<span><span class="co">#&gt; 4   1 4.3551357 46.183456  50.538592      1    event 46.183456 183.87376</span></span>
<span><span class="co">#&gt; 5   1 2.2841143 36.542496  38.826610      1    event 36.542496  41.66866</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">control_sim</span><span class="op">$</span><span class="va">arm</span>, <span class="va">control_sim</span><span class="op">$</span><span class="va">reason</span><span class="op">)</span></span>
<span><span class="co">#&gt;    </span></span>
<span><span class="co">#&gt;     event followup</span></span>
<span><span class="co">#&gt;   1   105       15</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Godwin Yung, Yi Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
